#!/bin/sh

#Установка нужных компонентов
sudo apt install tftpd-hpa pxelinux syslinux apache2 -y

#Настройки Web-сервера Apache2
sudo sed -i 's/# AstraMode on/AstraMode off/' /etc/apache2/apache2.conf
sudo chmod 755 /var/www/html
sudo chown www-data:www-data /var/www/html

#Добавить папку для распакованного образа ОС (AstraLinux)
sudo mkdir -p /var/www/html/repo
sudo mkdir -p /var/www/html/repo/se

#Распаковнный ISO образ ОС (AstraLinux) перекинуть из Загрузок на web-сервер Apache2
sudo cp /home/ore/Загрузки/AL_SE_1.7.3/* /var/www/html/repo/se -r

#Добавление НАДстройки в конфиге DHCP-сервера
sudo echo 'allow booting;' >> /etc/dhcp/dhcpd.conf
sudo echo 'allow bootp;' >> /etc/dhcp/dhcpd.conf
sudo echo 'option fqdn.no-client-update    on;' >> /etc/dhcp/dhcpd.conf
sudo echo 'option fqdn.rcode2            255;' >> /etc/dhcp/dhcpd.conf
sudo echo 'option pxegrub code 150 = text ;' >> /etc/dhcp/dhcpd.conf
sudo echo '#' >> /etc/dhcp/dhcpd.conf
sudo echo '#Настройка для PXE сервера' >> /etc/dhcp/dhcpd.conf
sudo echo 'next-server 192.168.16.1;' >> /etc/dhcp/dhcpd.conf
sudo echo 'option architecture code 93 = unsigned integer 16 ;' >> /etc/dhcp/dhcpd.conf
sudo echo 'if option architecture = 00:07 {' >> /etc/dhcp/dhcpd.conf
sudo echo '  filename "bootx64.efi";' >> /etc/dhcp/dhcpd.conf
sudo echo '} elsif option architecture = 00:09 {' >> /etc/dhcp/dhcpd.conf
sudo echo '  filename "bootx64.efi";' >> /etc/dhcp/dhcpd.conf
sudo echo '} else {' >> /etc/dhcp/dhcpd.conf
sudo echo '  filename "pxelinux.0";' >> /etc/dhcp/dhcpd.conf
sudo echo '}' >> /etc/dhcp/dhcpd.conf
sudo echo '#' >> /etc/dhcp/dhcpd.conf

#Перезагрузить службу DHCP
sudo systemctl restart isc-dhcp-server.service

#Перекинуть linux и initrd.gz из ISO-netinst (закинуть образ AstraLinux в Загрузки)
sudo mkdir /srv/tftp/se/
sudo cp /home/ore/Загрузки/AL_SE_1.7.3/netinst/linux /srv/tftp/se/
sudo cp /home/ore/Загрузки/AL_SE_1.7.3/netinst/initrd.gz /srv/tftp/se/

#Скопировать в каталог /srv/tftp файл pxelinux.0 и необходимые библиотеки syslinux из установленной ОС:
sudo cp /usr/lib/PXELINUX/pxelinux.0 /srv/tftp/
sudo cp /usr/lib/syslinux/modules/bios/{chain.c32,ldlinux.c32,libcom32.c32,libutil.c32,menu.c32} /srv/tftp/

#Настройка pxelinux.cfg
sudo mkdir -p /srv/tftp/pxelinux.cfg
sudo touch /srv/tftp/pxelinux.cfg/default
sudo echo 'ui menu.c32' >> /srv/tftp/pxelinux.cfg/default
sudo echo 'PROMPT 0' >> /srv/tftp/pxelinux.cfg/default
sudo echo '#' >> /srv/tftp/pxelinux.cfg/default
sudo echo 'MENU TITLE PXE Boot menu' >> /srv/tftp/pxelinux.cfg/default
sudo echo 'TIMEOUT 50' >> /srv/tftp/pxelinux.cfg/default
sudo echo 'DEFAULT local' >> /srv/tftp/pxelinux.cfg/default
sudo echo '#' >> /srv/tftp/pxelinux.cfg/default
sudo echo 'LABEL local' >> /srv/tftp/pxelinux.cfg/default
sudo echo '    MENU LABEL Boot from local drive' >> /srv/tftp/pxelinux.cfg/default
sudo echo '    kernel chain.c32' >> /srv/tftp/pxelinux.cfg/default
sudo echo '    append hd0' >> /srv/tftp/pxelinux.cfg/default
sudo echo '# Astra Linux Special Edition' >> /srv/tftp/pxelinux.cfg/default
sudo echo 'LABEL netinstall' >> /srv/tftp/pxelinux.cfg/default
sudo echo '    MENU LABEL Start Astra Linux SE net install' >> /srv/tftp/pxelinux.cfg/default
sudo echo '    kernel se/linux' >> /srv/tftp/pxelinux.cfg/default
sudo echo '    append initrd=se/initrd.gz modprobe.blacklist=evbug auto=true priority=critical debian-installer/locale=en_US console-keymaps-at/keymap=ru hostname=student domain=dedov.ded astra-license/license=true url=tftp://192.168.16.1/se/preseed.cfg interface=auto netcfg/dhcp_timeout=60 astra_install=1 vga=788 debian-installer/allow_unauthenticated=true' >> /srv/tftp/pxelinux.cfg/default

#Настроить конфиг загрузчика GRUB
sudo rm  /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo touch /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg

sudo echo 'if loadfont $prefix/font.pf2 ; then' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  set gfxmode=800x600' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  set gfxpayload=keep' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  insmod efi_gop' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  insmod efi_uga' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  insmod video_bochs' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  insmod video_cirrus' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  insmod gfxterm' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  insmod png' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  terminal_output gfxterm' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo 'fi' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '#' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo 'if background_image /isolinux/splash.png; then' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  set color_normal=light-gray/black' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  set color_highlight=white/black' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo 'else' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  set menu_color_normal=cyan/blue' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '  set menu_color_highlight=white/blue' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo 'fi' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '#' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo 'menuentry "Boot default EFI bootloader" {' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo ' set background_color=black' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo ' regexp -s root "\((.+)\)" "$cmdpath"' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo ' chainloader /EFI/Boot/Bootx64.efi' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '}' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '# Установка Astra Linux Special Edition' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo "menuentry 'Install Astra Linux SE' {" >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '    set background_color=black' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '    linux    /se/linux modprobe.blacklist=evbug debian-installer/allow_unauthenticated=true auto=true priority=critical debian-installer/locale=en_US console-keymaps-at/keymap=ru hostname=student domain=dedov.ded astra-license/license=true url=tftp://192.168.16.1/se/preseed.cfg interface=auto netcfg/dhcp_timeout=60' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '    initrd   /se/initrd.gz' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg
sudo echo '}' >> /home/ore/Загрузки/netinst/debian-installer/amd64/grub/grub.cfg

#Отправить конфиг в tftp
sudo cp /home/ore/Загрузки/netinst/* /srv/tftp/ -r

#Перезапустим службы
sudo systemctl restart isc-dhcp-server.service
sudo systemctl restart tftpd-hpa
sudo systemctl restart apache2.service

#Настройка автоматической установки ОС в конфиге preseed.cfg
sudo touch /home/ore/Загрузки/preseed.cfg
sudo echo '# настройка языка и страны согласно локали.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i debian-installer/locale string ru_RU' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i debian-installer/locale select ru_RU.UTF-8' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i debian-installer/language string ru' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i debian-installer/country string RU' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i debian-installer/keymap string ru' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Выбор клавиатуры.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i console-tools/archs select at' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i console-keymaps-at/keymap select ru' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i console-setup/toggle string Alt+Shift' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i console-setup/layoutcode string ru' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i keyboard-configuration/toggle select Alt+Shift' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i keyboard-configuration/layoutcode string ru' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i keyboard-configuration/xkb-keymap select ru' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i languagechooser/language-name-fb select Russian' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i countrychooser/country-name select Russia' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# netcfg выберет активный сетевой интерфейс, если такой имеется. Если есть более одного интерфейса, то при данной настройке список интерфейсов выводится не будет.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i netcfg/choose_interface select auto' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Чтобы использовать нужный интерфейс:' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#d-i netcfg/choose_interface select eth1' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#non-free,contrib' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i apt-setup/non-free boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i apt-setup/contrib boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Имена хоста и домен, назначенные с помощью dhcp имеют приоритет над значениями, установленными здесь. Однако, установка значений всё ещё предотвращает показ вопросов, даже если значения получены от dhcp.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i netcfg/get_hostname string astra' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i netcfg/get_hostname seen true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i netcfg/get_domain string cct.rbt' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i apt-setup/services-select none' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i apt-setup/security_host string' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Выключить показ надоедливого диалога с WEP ключом.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i netcfg/wireless_wep string' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Репозиторий для установки' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i mirror/protocol string http' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i mirror/country string manual' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i mirror/http/hostname string 192.168.16.1' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i mirror/http/directory string /repo/se/' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i mirror/http/proxy string' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Задаёт, установлены или нет аппаратные часы по Гринвичу.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i clock-setup/utc boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Здесь вы можете указать любое допустимое значение для $TZ; смотрите допустимые значения в файле /usr/share/zoneinfo/.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i time/zone string Europe/Yekaterinburg' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i partman-auto/method string regular' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Если один из дисков, который нужно разметить с помощью автоматической разметки, содержит старую конфигурацию LVM, то пользователю выдаётся предупреждение. Ответ можно автоматизировать...' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i partman-auto/purge_lvm_from_device boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# И подтвердить запись lvm разделов.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i partman-lvm/confirm boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Для режима UEFI:' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i	partman-auto/choose_recipe	select	/lib/partman/recipes-amd64-efi/30atomic' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Этот параметр заставляет partman выполнить разметку автоматически без подтверждения.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i partman/confirm_write_new_label boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i partman/choose_partition select finish' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i partman/confirm boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i	partman-auto-crypto/erase_disks	boolean	true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i	partman-basicfilesystems/no_swap	boolean	true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i	partman-target/mount_failed	boolean	true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i	partman-partitioning/unknown_label	boolean	true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i	partman-auto/purge_lvm_from_device	string	true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i	partman-lvm/vgdelete_confirm	boolean	true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i	partman/confirm_write_new_label	string	true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i	partman-lvm/confirm	boolean	true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i partman/confirm_nooverwrite boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Устанавливаемый пакет (мета) с образом ядра; можно указать "none", если ядро устанавливать не нужно.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i base-installer/kernel/image string linux-image-generic' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Пропустить создание учётной записи суперпользователя (в обычной учётной записи пользователя можно использовать sudo).' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#d-i passwd/root-login boolean false' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Или же пропустить создание обычной учётной записи пользователя.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i passwd/make-user boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Пароль суперпользователя в виде MD5 хеша (P@ssw0rd)' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i passwd/root-password-crypted password $1$OdrgEUj5$DIiSWm9HkShgT7cZ7dIj//' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Создать учётную запись обычного пользователя.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i passwd/user-fullname string student' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i passwd/username string student' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Пароль обычного пользователя в виде MD5 хеша (P@ssw0rd)' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i passwd/user-password-crypted password $1$OdrgEUj5$DIiSWm9HkShgT7cZ7dIj//' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# По умолчанию программа установки требует, чтобы репозитории аутентифицировались с помощью известного ключа gpg. Этот параметр выключает данную аутентификацию.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i debian-installer/allow_unauthenticated string true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'tasksel tasksel/first multiselect Base packages, Fly desktop, Internet suite, Office suite' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'tasksel tasksel/astra-feat-setup multiselect' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i astra-additional-setup/os-check select Base security level Orel' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i astra-additional-setup/additional-settings-orel multiselect Disable ptrace capability' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#astra-additional-setup	astra-additional-setup/additional-settings	multiselect' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#d-i	astra-additional-setup/additional-settings	multiselect' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#astra-additional-setup	astra-additional-setup/automatic-network-disable	multiselect' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#d-i	astra-additional-setup/automatic-network-disable	multiselect' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#d-i desktop-tablet-mode-switch/tablet-mode multiselect' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'tripwire tripwire/use-localkey boolean false' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'ripwire tripwire/use-sitekey boolean false' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'tripwire tripwire/installed note ok' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'portsentry portsentry/warn_no_block note ok' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'astra-license astra-license/license boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'krb5-config krb5-config/kerberos_servers string' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'libnss-ldapd libnss-ldapd/ldap-base string' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'libnss-ldapd libnss-ldapd/ldap-uris string' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'libnss-ldapd libnss-ldapd/nsswitch multiselect services' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'ald-client ald-client/make_config boolean false' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'ald-client ald-client/manual_configure false' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'astra-feat-setup astra-feat-setup/feat multiselect kiosk mode false' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'astra-feat-setup astra-feat-setup/feat multiselect Служба ALD false' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i console-cyrillic/switch select "Клавиша Menu"' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i console-cyrillic/toggle select Control+Shift' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i samba-common/dhcp boolean false' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i samba-common/workgroup string testgroup1' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Некоторые версии программы установки могут отсылать отчёт об установленных пакетах. По умолчанию данная возможность выключена, но отправка отчёта помогает проекту определить популярность программ и какие из них включать на CD.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'popularity-contest popularity-contest/participate boolean false' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Эту переменную можно безопасно устанавливать, она указывает, что grub должен устанавливаться в MBR, если на машине не найдено другой операционной системы.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i grub-installer/only_debian boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Это заставляет grub-installer устанавливать в MBR, даже если на машине есть другая ОС, что менее безопасно, так как может привести к отказу загрузки этой другой ОС.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i grub-installer/with_other_os boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Необязательный пароль на grub, или в виде открытого текста в шифрованном виде с помощью хеша MD5, смотрите grub-md5-crypt(P@ssw0rd).' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i grub-installer/password-crypted password $1$OdrgEUj5$DIiSWm9HkShgT7cZ7dIj//' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Не показывать последнее сообщение о том, что установка завершена.' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i finish-install/reboot_in_progress note' >> /home/ore/Загрузки/preseed.cfg
sudo echo 'd-i finish-install/exit/poweroff boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Остановить систему после завершения установки, а не перегружаться в установленную систему.' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#d-i debian-installer/exit/halt boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Эта настройка позволяет выключить питание машины, а не просто остановить её.' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#d-i debian-installer/exit/poweroff boolean true' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#' >> /home/ore/Загрузки/preseed.cfg
sudo echo '# Эта команда выполняется перед окончанием установки, пока ещё есть рабочий каталог /target. Вы можете выполнить chroot в /target и непосредственно использовать его, или же воспользоваться командами apt-install и in-target для облегчения задачи установки пакетов и запуска команд в целевой системе.' >> /home/ore/Загрузки/preseed.cfg
sudo echo '#d-i preseed/late_command string in-target systemctl enable ssh' >> /home/ore/Загрузки/preseed.cfg

sudo cp /home/ore/Загрузки/preseed.cfg /srv/tftp/se/preseed.cfg
